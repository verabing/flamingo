<!DOCTYPE html>
<html lang="de">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Flamingo meets artist</title>

  <!-- CSV-Parser -->
  <script src="https://unpkg.com/papaparse@5.4.1/papaparse.min.js"></script>

  <style>
    :root{
      --accent:#db3553; /* Flamingo-Rosa (dein Wunschton) */
      --accent-weak:#fbe3e7;
      --bg:#ffffff;
      --text:#2b2b2b;
      --muted:#6b6b6b;
      --card:#ffffff;
      --border:#eee;
      --shadow:0 6px 24px rgba(0,0,0,.06);
      --radius:14px;
    }
    *{box-sizing:border-box}
    html,body{margin:0;background:var(--bg);color:var(--text);font-family:system-ui,-apple-system,Segoe UI,Roboto,Inter,Arial,sans-serif}
    a{color:var(--accent);text-decoration:none}
    a:hover{text-decoration:underline}

    /* Header */
    header{
      position:sticky;top:0;z-index:10;background:var(--bg);
      border-bottom:1px solid var(--border);
      backdrop-filter:saturate(1.2) blur(4px);
    }
    .wrap{max-width:1200px;margin:0 auto;padding:18px 18px}
    .title{
      display:flex;align-items:center;gap:12px;justify-content:center;
      font-weight:800;font-size:24px;letter-spacing:.2px;
    }
    .flamingo-dot{
      width:12px;height:12px;border-radius:50%;background:var(--accent);
      box-shadow:0 0 0 6px var(--accent-weak);
    }

    /* Controls */
    .controls{
      display:grid;grid-template-columns:repeat(12,1fr);gap:10px;margin-top:12px;
    }
    .controls select,.controls input[type="search"], .fav-toggle{
      grid-column: span 4;
      padding:11px 12px;border:1px solid var(--border);border-radius:12px;background:#fff;
      font-size:14px;outline:none;
    }
    .controls input[type="search"]{grid-column: span 5;}
    .fav-toggle{
      grid-column: span 3; display:flex;align-items:center;justify-content:center;gap:8px;
      cursor:pointer;user-select:none;background:var(--accent-weak);border-color:transparent;color:var(--accent);font-weight:600;
    }
    .fav-toggle.active{background:var(--accent);color:#fff}

    /* Main layout */
    main{max-width:1200px;margin:0 auto;padding:18px}
    .grid{
      display:grid;gap:16px;
      grid-template-columns: repeat( auto-fill, minmax(180px,1fr) );
    }
    .card{
      background:var(--card);border:1px solid var(--border);border-radius:var(--radius);
      box-shadow:var(--shadow);overflow:hidden;cursor:pointer;transition:transform .08s ease;
    }
    .card:hover{transform:translateY(-2px)}
    .thumb{
      width:100%;aspect-ratio:1/1;object-fit:cover;background:#f6f6f6;
    }
    .meta{padding:10px 12px}
    .name{font-weight:700;font-size:15px;margin:2px 0 6px}
    .sub{color:var(--muted);font-size:12px;display:flex;gap:6px;flex-wrap:wrap}
    .badge{
      display:inline-flex;align-items:center;gap:6px;
      font-size:11px;color:var(--accent);background:var(--accent-weak);padding:4px 8px;border-radius:999px;font-weight:700
    }

    /* Detail view */
    .detail{max-width:900px;margin:0 auto;display:none}
    .back{
      display:inline-flex;align-items:center;gap:8px;margin:6px 0 16px;
      padding:10px 12px;border-radius:10px;border:1px solid var(--border);background:#fff;cursor:pointer;
    }
    .detail-head{
      display:grid;grid-template-columns:1.2fr .8fr;gap:18px;align-items:start;
    }
    @media (max-width:880px){ .detail-head{grid-template-columns:1fr} }
    .detail-title{margin:0;font-size:28px;font-weight:900}
    .detail-sub{color:var(--muted);margin:8px 0 14px}
    .chips{display:flex;gap:8px;flex-wrap:wrap;margin:8px 0}
    .chip{
      font-size:12px;border-radius:999px;border:1px solid var(--border);padding:5px 10px;background:#fff;cursor:pointer
    }
    .chip:hover{border-color:var(--accent);color:var(--accent)}
    .detail-img{
      width:100%;border-radius:12px;border:1px solid var(--border);background:#f6f6f6;object-fit:cover;max-height:520px
    }
    .detail-section{margin:18px 0}
    .quote{
      border-left:4px solid var(--accent);padding:10px 12px;background:#fff; border-radius:8px;
      font-style:italic;color:#111
    }
    .links{display:flex;gap:10px;flex-wrap:wrap;margin-top:6px}
    .btn{
      display:inline-flex;align-items:center;gap:8px;padding:9px 12px;border-radius:10px;
      border:1px solid var(--accent);color:var(--accent);background:#fff;font-weight:600
    }
    .btn:hover{background:var(--accent-weak)}
    .hidden{display:none !important}
    .empty{padding:24px;color:var(--muted);text-align:center}
  </style>
</head>
<body>

  <!-- Header -->
  <header>
    <div class="wrap">
      <div class="title">
        <span class="flamingo-dot" aria-hidden="true"></span>
        <span>Flamingo meets artist</span>
      </div>
      <div class="controls">
        <select id="styleFilter">
          <option value="">Art Style (alle)</option>
        </select>
        <select id="nationFilter">
          <option value="">Nationality (alle)</option>
        </select>
        <input id="searchInput" type="search" placeholder="Suche: Name, Stil, Nationalit√§t, Werke, Zitat ‚Ä¶" />
        <button id="favToggle" class="fav-toggle" type="button" title="Nur Lieblinge anzeigen">
          <span>üíñ</span><span>Lieblinge</span>
        </button>
      </div>
    </div>
  </header>

  <!-- Galerie -->
  <main>
    <section id="gallery" class="grid" aria-live="polite"></section>
    <div id="emptyState" class="empty hidden">Keine Treffer mit den aktuellen Filtern.</div>

    <!-- Detail -->
    <section id="detail" class="detail">
      <button class="back" id="backBtn" type="button">‚Üê Zur√ºck zur √úbersicht</button>
      <div class="detail-head">
        <div>
          <h1 id="dName" class="detail-title"></h1>
          <div id="dDates" class="detail-sub"></div>
          <div class="chips">
            <span id="dStyle" class="chip"></span>
            <span id="dNation" class="chip"></span>
            <span id="dFav" class="badge hidden">üíñ Liebling</span>
          </div>
          <div id="dBio" class="detail-section"></div>
          <div id="dWorks" class="detail-section"></div>
          <div id="dQuote" class="detail-section hidden">
            <div class="quote" id="dQuoteText"></div>
          </div>
          <div class="links">
            <a id="dWiki" class="btn" href="#" target="_blank" rel="noopener">Wikipedia</a>
            <a id="dImgSearch" class="btn" href="#" target="_blank" rel="noopener">Bilder suchen</a>
          </div>
        </div>
        <div>
          <img id="dPhoto" class="detail-img" alt="Artist photo" />
        </div>
      </div>
    </section>
  </main>

  <script>
    // ---- Konfiguration
    const SHEET_CSV_URL = "https://docs.google.com/spreadsheets/d/1REI62_PJYuDrFoasl6j6KfQUkVGvLKKlrF5Lzga10t4/gviz/tq?tqx=out:csv";
    const COL = {
      style: 'Art style',
      photo: 'Photo',
      name: 'artist',
      dates: 'born - death',
      nation: 'Nationality',
      works: 'Famous Work',
      bio: 'Short biography',
      quote: 'Known "Quote" or "quirk"',
      fav: 'Lieblinge',
      wiki: 'Wikipedia search',
      imgSearch: 'Images search'
    };

    // ---- State
    let rows = [];             // alle Datens√§tze
    let filtered = [];         // nach Filter+Suche gefiltert
    let byName = new Map();    // Name -> Row (f√ºr Detailansicht)
    let favOnly = false;

    const els = {
      gallery: document.getElementById('gallery'),
      empty: document.getElementById('emptyState'),
      detail: document.getElementById('detail'),
      backBtn: document.getElementById('backBtn'),
      styleFilter: document.getElementById('styleFilter'),
      nationFilter: document.getElementById('nationFilter'),
      search: document.getElementById('searchInput'),
      favToggle: document.getElementById('favToggle'),

      dName: document.getElementById('dName'),
      dDates: document.getElementById('dDates'),
      dStyle: document.getElementById('dStyle'),
      dNation: document.getElementById('dNation'),
      dFav: document.getElementById('dFav'),
      dBio: document.getElementById('dBio'),
      dWorks: document.getElementById('dWorks'),
      dQuote: document.getElementById('dQuote'),
      dQuoteText: document.getElementById('dQuoteText'),
      dWiki: document.getElementById('dWiki'),
      dImgSearch: document.getElementById('dImgSearch'),
      dPhoto: document.getElementById('dPhoto'),
    };

    // ---- Hilfen
    function isFav(val){
      if(!val) return false;
      const v = String(val).trim().toLowerCase();
      return v && v !== '0' && v !== 'false' && v !== 'nein' && v !== 'no';
    }
    function uniqSorted(list){
      return Array.from(new Set(list.filter(Boolean).map(s=>String(s).trim()))).sort((a,b)=>a.localeCompare(b));
    }
    function field(row, key){ return row?.[key] ?? ''; }

    // ---- Daten laden
    Papa.parse(SHEET_CSV_URL, {
      download: true,
      header: true,
      skipEmptyLines: true,
      complete: (res)=>{
        rows = res.data.map(r => ({
          style: field(r, COL.style),
          photo: field(r, COL.photo),
          name: field(r, COL.name),
          dates: field(r, COL.dates),
          nation: field(r, COL.nation),
          works: field(r, COL.works),
          bio: field(r, COL.bio),
          quote: field(r, COL.quote),
          fav: field(r, COL.fav),
          wiki: field(r, COL.wiki),
          imgSearch: field(r, COL.imgSearch)
        })).filter(r=>r.name);

        rows.forEach(r => byName.set(r.name, r));
        initFilters();
        applyFromURL(); // ?artist=...
        render();
      },
      error: (err)=>{ console.error('CSV-Fehler', err); alert('Fehler beim Laden der Daten.'); }
    });

    // ---- Filter initialisieren
    function initFilters(){
      const styles = uniqSorted(rows.map(r=>r.style));
      const nations = uniqSorted(rows.map(r=>r.nation));

      styles.forEach(s=>{
        const opt = document.createElement('option');
        opt.value = s; opt.textContent = s;
        els.styleFilter.appendChild(opt);
      });
      nations.forEach(n=>{
        const opt = document.createElement('option');
        opt.value = n; opt.textContent = n;
        els.nationFilter.appendChild(opt);
      });

      els.styleFilter.addEventListener('change', ()=>{ syncURL(null); render(); });
      els.nationFilter.addEventListener('change', ()=>{ syncURL(null); render(); });
      els.search.addEventListener('input', ()=>{ syncURL(null); render(); });
      els.favToggle.addEventListener('click', ()=>{
        favOnly = !favOnly;
        els.favToggle.classList.toggle('active', favOnly);
        syncURL(null);
        render();
      });

      els.backBtn.addEventListener('click', ()=>{ showList(); syncURL(null); });
    }

    // ---- Rendering
    function render(){
      const q = els.search.value.trim().toLowerCase();
      const fStyle = els.styleFilter.value;
      const fNation = els.nationFilter.value;

      filtered = rows.filter(r=>{
        if (fStyle && r.style !== fStyle) return false;
        if (fNation && r.nation !== fNation) return false;
        if (favOnly && !isFav(r.fav)) return false;
        if (!q) return true;
        const hay = [r.name,r.style,r.nation,r.works,r.bio,r.quote].join(' | ').toLowerCase();
        return hay.includes(q);
      });

      if (document.body.dataset.view === 'detail') return; // Detail aktiv: Liste nicht neu zeichnen

      els.gallery.innerHTML = '';
      filtered.forEach(r=>{
        const card = document.createElement('article');
        card.className = 'card';
        card.setAttribute('role','button');
        card.title = r.name;

        const img = document.createElement('img');
        img.className = 'thumb';
        img.alt = r.name;
        img.loading = 'lazy';
        img.src = r.photo || '';
        img.onerror = ()=>{ img.src = 'data:image/svg+xml;charset=utf8,' + encodeURIComponent(`<svg xmlns="http://www.w3.org/2000/svg" width="600" height="600"><rect width="100%" height="100%" fill="#f4f4f4"/><text x="50%" y="50%" dominant-baseline="middle" text-anchor="middle" fill="#999" font-family="Arial" font-size="20">No Image</text></svg>`); };

        const meta = document.createElement('div'); meta.className='meta';
        const name = document.createElement('div'); name.className='name'; name.textContent = r.name;
        const sub = document.createElement('div'); sub.className='sub';
        sub.innerHTML = `
          <span>${r.style || '‚Äî'}</span> ‚Ä¢ <span>${r.nation || '‚Äî'}</span>
          ${isFav(r.fav) ? `&nbsp;<span class="badge">üíñ Lieblingsartist</span>` : ``}
        `;

        meta.appendChild(name); meta.appendChild(sub);
        card.appendChild(img); card.appendChild(meta);
        card.addEventListener('click', ()=>{
          showDetail(r.name);
          syncURL(r.name);
        });

        els.gallery.appendChild(card);
      });

      els.empty.classList.toggle('hidden', filtered.length>0);
    }

    // ---- Detail
    function showDetail(name){
      const r = byName.get(name);
      if(!r){ console.warn('Artist nicht gefunden', name); return; }

      document.body.dataset.view = 'detail';
      els.gallery.classList.add('hidden');
      els.empty.classList.add('hidden');
      els.detail.style.display = 'block';

      els.dName.textContent = r.name;
      els.dDates.textContent = r.dates || '';
      els.dStyle.textContent = r.style || '‚Äî';
      els.dNation.textContent = r.nation || '‚Äî';
      els.dFav.classList.toggle('hidden', !isFav(r.fav));
